---
# tasks file for metricbeat
- name: Install deb package for metricbeat
  ansible.builtin.apt:
    deb: "{{metricbeat_package_url}}"
    state: present

- name: Template metricbeat config
  template:
    src: ./templates/metricbeat.yml.j2
    dest: /etc/metricbeat/metricbeat.yml
  notify:
    - restart metricbeat 

- name: metricbeat modules enable system
  ansible.builtin.command: metricbeat modules enable system
  become: yes
  #become_user: root
  register: metr

- name: metricbeat setup
  ansible.builtin.command: metricbeat setup
  become: yes
  #become_user: root
  register: metr

- name: Ensure metricbeat is running (and enable it at boot)
  service: 
    name: metricbeat 
    enabled: yes
  notify:
    - restart metricbeat 
